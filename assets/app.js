!function(e){function t(t){for(var o,a,s=t[0],c=t[1],l=t[2],d=0,m=[];d<s.length;d++)a=s[d],r[a]&&m.push(r[a][0]),r[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(u&&u(t);m.length;)m.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={0:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/assets/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;i.push([6,1]),n()}({6:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t);class r{}o(r,"CLICK","click"),o(r,"START",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchstart":"mousedown"),o(r,"MOVE",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchmove":"mousemove"),o(r,"END",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchend":"mouseup");var i=n(0),a=n.n(i),s=n(1),c=n.n(s);const l="http://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/360square-keio-orche2/video.m3u8";let u=null,d=null;document.addEventListener("DOMContentLoaded",()=>{u=document.getElementById("video")},!0);const m=()=>{if(c.a.isSupported()){const e=new c.a;e.loadSource(l),e.attachMedia(u),e.on(c.a.Events.MANIFEST_PARSED,()=>{console.log("video is ready")})}else u.canPlayType("application/vnd.apple.mpegurl")&&(u.src=l,u.addEventListener("loadedmetadata",()=>{console.log("video is ready")}))},p=()=>{const e=u.play();void 0!==e&&e.then(()=>{clearTimeout(d),d=null}).catch(()=>{d=setTimeout(p,1e3)})},f=e=>{u.currentTime=e},h=new(window.AudioContext||window.webkitAudioContext),y=h.createGain(),g=h.createDynamicsCompressor(),b=h.listener,v="http://sdm.hongo.wide.ad.jp/~kawa/audio/keio-concert-audiosprited/koc.mp3",x=86.6250113378685,w=[{start:0,end:x},{start:88,end:88+x},{start:176,end:176+x},{start:264,end:264+x},{start:352,end:352+x},{start:440,end:440+x},{start:528,end:528+x},{start:616,end:616+x},{start:704,end:704+x}],E=[{x:3.05,y:1,z:-7.33},{x:1.86,y:1,z:-3.24},{x:-1.58,y:1,z:3.18},{x:-6.36,y:1,z:-6.79},{x:6.08,y:1,z:-2.51},{x:5.14,y:1,z:1.03},{x:-5.17,y:1,z:1.89},{x:-5.77,y:1,z:-1.29},{x:-9.19,y:1,z:-1.41}],A=[],M=[],P=[],T=[],z=[],C=[];for(let e=0,t=w.length;e<t;e++)z[e]=!1,C[e]=0;let S=null,O=!1,j=!0;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("ascn");for(let t=0,n=w.length;t<n;t++){const n=document.createElement("a-entity");n.setAttribute("id",`sphere${t}`),n.setAttribute("class","clickable"),n.setAttribute(`cursor-listener${t}`,""),e.appendChild(n)}},!0),a.a.registerComponent("cursor-listener-switch",{init:function(){this.el.addEventListener("mousedown",function(){if(!j)if(O){u.play().then(()=>{u.pause()}).catch(()=>{});for(let e=0,t=w.length;e<t;e++)A[e].stop(0);this.setAttribute("material","color","cyan"),O=!1}else{p();for(let e=0,t=w.length;e<t;e++){T[e]=h.createAnalyser(),T[e].smoothingTimeConstant=.7,M[e]=h.createGain(),M[e].gain.value=.5,P[e]=h.createPanner(),P[e].panningModel="equalpower",P[e].distanceModel="inverse";const t=document.getElementById(`sphere${e}`),n=new THREE.Vector3;n.setFromMatrixPosition(t.object3D.matrixWorld);const{x:o,y:r,z:i}=n;P[e].setPosition(o,r,i),A[e]=h.createBufferSource(),A[e].buffer=S,A[e].connect(M[e]),M[e].connect(P[e]),P[e].connect(T[e]),T[e].connect(y),y.connect(g),g.connect(h.destination),A[e].loopStart=w[e].start,A[e].loopEnd=w[e].end;let a=C[e]>0?h.currentTime-C[e]:0;a>x&&(a=0,C[e]=0),A[e].start(0,w[e].start+a,w[e].end-w[e].start-a),A[e].loop=!0,f(a),C[e]=h.currentTime}this.setAttribute("material","color","gray"),O=!0}})}});const k=e=>{let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t),o=e[t-1];e[t-1]=e[n],e[n]=o,t--}};for(let e=0,t=w.length;e<t;e++){const t=(1+Math.sqrt(5))/2,n=[[1,-t,0],[-1,-t,0],[0,-(2*t+1)/3,t/3],[0,-(2*t+1)/3,-t/3],[0,-1,t],[0,-1,-t],[(t+1)/3,-(t+1)/3,(t+1)/3],[(t+1)/3,-(t+1)/3,-(t+1)/3],[-(t+1)/3,-(t+1)/3,-(t+1)/3],[-(t+1)/3,-(t+1)/3,(t+1)/3],[(2*t+1)/3,-t/3,0],[-(2*t+1)/3,-t/3,0],[t/3,0,(2*t+1)/3],[t,0,1],[t,0,-1],[t/3,0,-(2*t+1)/3],[-t/3,0,-(2*t+1)/3],[-t,0,-1],[-t,0,1],[-t/3,0,(2*t+1)/3],[(2*t+1)/3,t/3,0],[-(2*t+1)/3,t/3,0],[(t+1)/3,(t+1)/3,(t+1)/3],[(t+1)/3,(t+1)/3,-(t+1)/3],[-(t+1)/3,(t+1)/3,-(t+1)/3],[-(t+1)/3,(t+1)/3,(t+1)/3],[0,1,t],[0,1,-t],[0,(2*t+1)/3,t/3],[0,(2*t+1)/3,-t/3],[1,t,0],[-1,t,0]],o=[],r=n.length,i=.15,s=new THREE.Vector3(0,1,0),c={min:null,max:null};k(n),a.a.registerComponent(`cursor-listener${e}`,{init:function(){this.el.setAttribute("geometry",{primitive:"sphere",radius:.6}),this.el.setAttribute("position",E[e]),this.el.setAttribute("scale",{x:.3,y:.3,z:.3}),this.el.setAttribute("material",{color:"gray",transparent:!0,opacity:0});for(let e=0;e<r;e++){o[e]=document.createElement("a-entity"),n[e]=new THREE.Vector3(...n[e]).normalize();const t=.1,r=n[e],a=o[e];a.setAttribute("geometry",{primitive:"box",width:i,height:t,depth:i}),a.setAttribute("position",r.clone().multiplyScalar(t/2+1)),a.setAttribute("material",{color:"gray",transparent:!0,opacity:.9}),a.object3D.quaternion.setFromUnitVectors(s,r),this.el.append(a)}this.el.addEventListener("mousedown",function(){O&&(z[e]?(M[e].gain.value=.5,z[e]=!1):(M[e].gain.value=0,z[e]=!0))})},tick:function(){if(!T[e])return;const t=new Uint8Array(T[e].frequencyBinCount);T[e].getByteFrequencyData(t),null===c.min&&(c.min=T[e].frequencyBinCount-1);for(let e=0;e<c.min;e++)if(0!==t[e]){c.min=e;break}null===c.max&&(c.max=0);for(let n=T[e].frequencyBinCount-1;n>c.max;n--)if(0!==t[n]){c.max=n;break}const i=c.max-c.min<0?{min:0,max:T[e].frequencyBinCount-1}:{min:c.min,max:c.max},a=i.max-i.min+1,s=Math.floor(a/r),l=a%r;for(let a=0,c=i.min;a<r;a++){const r=a<l?s+1:s;let i=0;for(let e=0;e<s;e++)i+=t[c+e];const u=1-2**(-20*((0===r?0:i/r)/255)),d=0===M[e].gain.value?.1:L(u),m=0===M[e].gain.value?"gray":D(u),p=n[a],f=o[a];f.setAttribute("geometry","height",d),f.setAttribute("position",p.clone().multiplyScalar(d/2+1)),f.setAttribute("material","color",m),c+=s}}})}const L=e=>e<.1?.1:3*e,D=e=>{const t=[0,0,0];return e=2*e-1,t[0]=e<0?0:e>=0&&e<.5?Math.floor(2*e*255):255,t[1]=e<-.5?Math.floor(2*(e+1)*255):e>=-.5&&e<.5?255:255-Math.floor(2*(e-.5)*255),t[2]=e<-.5?255:e>=-.5&&e<0?255-Math.floor(2*(e+.5)*255):0,`rgb(${t[0]}, ${t[1]}, ${t[2]})`};async function R(){"running"!==h.state&&await h.resume(),document.removeEventListener(r.START,R,!1)}a.a.registerComponent("rotation-reader",{tick:function(){const e=this.el.object3D;e.updateMatrixWorld();const t=e.matrixWorld,n=(new THREE.Vector3).setFromMatrixPosition(t);b.setPosition(n.x,n.y,n.z);const o=t.clone();o.setPosition({x:0,y:0,z:0});const r=new THREE.Vector3(0,0,1);r.applyMatrix4(o),r.normalize();const i=new THREE.Vector3(0,-1,0);i.applyMatrix4(o),i.normalize(),b.setOrientation(r.x,r.y,r.z,i.x,i.y,i.z)}}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener(r.START,R,!1),function(){const e=new XMLHttpRequest;e.open("GET",v,!0),e.responseType="arraybuffer",e.send(null),e.onload=()=>{h.decodeAudioData(e.response,e=>{S=e,m(),document.getElementById("sphere-switch").setAttribute("material","color","cyan"),j=!1},()=>{})}}()},!0)}});
//# sourceMappingURL=app.js.map