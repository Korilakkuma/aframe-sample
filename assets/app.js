!function(e){function t(t){for(var o,c,i=t[0],s=t[1],l=t[2],u=0,m=[];u<i.length;u++)c=i[u],r[c]&&m.push(r[c][0]),r[c]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);for(d&&d(t);m.length;)m.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,i=1;i<n.length;i++){var s=n[i];0!==r[s]&&(o=!1)}o&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},r={0:0},a=[];function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/assets/";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var d=s;a.push([6,1]),n()}({6:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t);class r{}o(r,"CLICK","click"),o(r,"START",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchstart":"mousedown"),o(r,"MOVE",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchmove":"mousemove"),o(r,"END",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchend":"mouseup");var a=n(0),c=n.n(a),i=n(2),s=n.n(i);const l={concert:"https://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/360square-keio-orche2/video.m3u8",jazz:"https://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/billboard1_er/video.m3u8"},d={concert:null,jazz:null};document.addEventListener("DOMContentLoaded",()=>{d.concert=document.getElementById("concert-video"),d.jazz=document.getElementById("jazz-video")},!0);const u=e=>{if(s.a.isSupported()){const t=new s.a;t.loadSource(l[e]),t.attachMedia(d[e])}else d[e].canPlayType("application/vnd.apple.mpegurl")&&(d[e].src=l[e])},m=async e=>{try{await d[e].play(),d[e].pause()}catch(e){}},p=(e,t)=>{d[t].currentTime=e},h=["concert","jazz"],y=e=>{let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t),o=e[t-1];e[t-1]=e[n],e[n]=o,t--}},f=e=>e<.1?.1:3*e,z=e=>{const t=[0,0,0];return e=2*e-1,t[0]=e<0?0:e>=0&&e<.5?Math.floor(2*e*255):255,t[1]=e<-.5?Math.floor(2*(e+1)*255):e>=-.5&&e<.5?255:255-Math.floor(2*(e-.5)*255),t[2]=e<-.5?255:e>=-.5&&e<0?255-Math.floor(2*(e+.5)*255):0,`rgb(${t[0]}, ${t[1]}, ${t[2]})`},g=new(window.AudioContext||window.webkitAudioContext),b=g.createGain(),v=g.createDynamicsCompressor(),x=g.listener,w={concert:"https://sdm.hongo.wide.ad.jp/~kawa/audio/keio-concert-audiosprited/koc.mp3",jazz:"./assets/audio/original.mp3"},E={concert:86.6250113378685,jazz:194.61224489},j={concert:[{start:0,end:E.concert},{start:88,end:88+E.concert},{start:176,end:176+E.concert},{start:264,end:264+E.concert},{start:352,end:352+E.concert},{start:440,end:440+E.concert},{start:528,end:528+E.concert},{start:616,end:616+E.concert},{start:704,end:704+E.concert}],jazz:[{start:784,end:784+E.jazz},{start:0,end:E.jazz},{start:196,end:196+E.jazz}]},A={concert:[{x:3.05,y:1,z:-7.33},{x:1.86,y:1,z:-3.24},{x:-1.58,y:1,z:3.18},{x:-6.36,y:1,z:-6.79},{x:6.08,y:1,z:-2.51},{x:5.14,y:1,z:1.03},{x:-5.17,y:1,z:1.89},{x:-5.77,y:1,z:-1.29},{x:-9.19,y:1,z:-.91}],jazz:[{x:3,y:.5,z:-5},{x:-3,y:1,z:-5},{x:-.5,y:.7,z:-5}]},L={concert:[],jazz:[]},M={concert:[],jazz:[]},P={concert:[],jazz:[]},T={concert:[],jazz:[]},C={concert:[],jazz:[]},S={concert:[],jazz:[]};for(let e=0,t=j.concert.length;e<t;e++)C.concert[e]=!1,S.concert[e]=0;for(let e=0,t=j.jazz.length;e<t;e++)C.jazz[e]=!1,S.jazz[e]=0;const $={concert:null,jazz:null},q={concert:!1,jazz:!1},B={concert:!0,jazz:!0};async function F(){"running"!==g.state&&await g.resume(),document.removeEventListener(r.START,F,!1)}h.forEach(e=>{c.a.registerComponent(`${e}-cursor-listener-switch`,{init:function(){this.el.addEventListener("mousedown",function(){if(!B[e])if(q[e]){m(e);for(let t=0,n=j[e].length;t<n;t++)L[e][t].stop(0);this.setAttribute("material","color","cyan"),q[e]=!1}else{(async e=>{try{await d[e].play()}catch(e){}})(e);for(let t=0,n=j[e].length;t<n;t++){T[e][t]=g.createAnalyser(),T[e][t].smoothingTimeConstant=.7,M[e][t]=g.createGain(),M[e][t].gain.value=.5,P[e][t]=g.createPanner(),P[e][t].panningModel="equalpower",P[e][t].distanceModel="inverse";const n=document.getElementById(`${e}-sphere${t}`),o=new THREE.Vector3;o.setFromMatrixPosition(n.object3D.matrixWorld);const{x:r,y:a,z:c}=o;P[e][t].setPosition(r,a,c),L[e][t]=g.createBufferSource(),L[e][t].buffer=$[e],L[e][t].connect(M[e][t]),M[e][t].connect(P[e][t]),P[e][t].connect(T[e][t]),T[e][t].connect(b),b.connect(v),v.connect(g.destination),L[e][t].loopStart=j[e][t].start,L[e][t].loopEnd=j[e][t].end;let i=S[e][t]>0?g.currentTime-S[e][t]:0;i>E[e]&&(i=0,S[e][t]=0),L[e][t].start(0,j[e][t].start+i,j[e][t].end-j[e][t].start-i),L[e][t].loop=!0,p(i,e),S[e][t]=g.currentTime}this.setAttribute("material","color","gray"),q[e]=!0}})}});for(let t=0,n=j[e].length;t<n;t++){const n=(1+Math.sqrt(5))/2,o=[[1,-n,0],[-1,-n,0],[0,-(2*n+1)/3,n/3],[0,-(2*n+1)/3,-n/3],[0,-1,n],[0,-1,-n],[(n+1)/3,-(n+1)/3,(n+1)/3],[(n+1)/3,-(n+1)/3,-(n+1)/3],[-(n+1)/3,-(n+1)/3,-(n+1)/3],[-(n+1)/3,-(n+1)/3,(n+1)/3],[(2*n+1)/3,-n/3,0],[-(2*n+1)/3,-n/3,0],[n/3,0,(2*n+1)/3],[n,0,1],[n,0,-1],[n/3,0,-(2*n+1)/3],[-n/3,0,-(2*n+1)/3],[-n,0,-1],[-n,0,1],[-n/3,0,(2*n+1)/3],[(2*n+1)/3,n/3,0],[-(2*n+1)/3,n/3,0],[(n+1)/3,(n+1)/3,(n+1)/3],[(n+1)/3,(n+1)/3,-(n+1)/3],[-(n+1)/3,(n+1)/3,-(n+1)/3],[-(n+1)/3,(n+1)/3,(n+1)/3],[0,1,n],[0,1,-n],[0,(2*n+1)/3,n/3],[0,(2*n+1)/3,-n/3],[1,n,0],[-1,n,0]],r=[],a=o.length,i=.15,s=new THREE.Vector3(0,1,0),l={min:null,max:null};y(o),c.a.registerComponent(`${e}-cursor-listener${t}`,{init:function(){this.el.setAttribute("geometry",{primitive:"sphere",radius:1}),this.el.setAttribute("position",A[e][t]),this.el.setAttribute("scale",{x:.3,y:.3,z:.3}),this.el.setAttribute("material",{color:"gray",transparent:!0,opacity:0});for(let e=0;e<a;e++){r[e]=document.createElement("a-entity"),o[e]=new THREE.Vector3(...o[e]).normalize();const t=.1,n=o[e],a=r[e];a.setAttribute("geometry",{primitive:"box",width:i,height:t,depth:i}),a.setAttribute("position",n.clone().multiplyScalar(t/2+1)),a.setAttribute("material",{color:"gray",transparent:!0,opacity:.9}),a.object3D.quaternion.setFromUnitVectors(s,n),this.el.append(a)}this.el.addEventListener("mousedown",function(){q[e]&&(C[e][t]?(M[e][t].gain.value=.5,C[e][t]=!1):(M[e][t].gain.value=0,C[e][t]=!0))})},tick:function(){if(!T[e][t])return;const n=new Uint8Array(T[e][t].frequencyBinCount);T[e][t].getByteFrequencyData(n),null===l.min&&(l.min=T[e][t].frequencyBinCount-1);for(let e=0;e<l.min;e++)if(0!==n[e]){l.min=e;break}null===l.max&&(l.max=0);for(let o=T[e][t].frequencyBinCount-1;o>l.max;o--)if(0!==n[o]){l.max=o;break}const c=l.max-l.min<0?{min:0,max:T[e][t].frequencyBinCount-1}:{min:l.min,max:l.max},i=c.max-c.min+1,s=Math.floor(i/a),d=i%a;for(let i=0,l=c.min;i<a;i++){const a=i<d?s+1:s;let c=0;for(let e=0;e<s;e++)c+=n[l+e];const u=1-2**(-20*((0===a?0:c/a)/255)),m=q[e]&&0!==M[e][t].gain.value?f(u):.1,p=q[e]&&0!==M[e][t].gain.value?z(u):"gray",h=o[i],y=r[i];y.setAttribute("geometry","height",m),y.setAttribute("position",h.clone().multiplyScalar(m/2+1)),y.setAttribute("material","color",p),l+=s}}})}c.a.registerComponent(`${e}-rotation-reader`,{tick:function(){const e=this.el.object3D;e.updateMatrixWorld();const t=e.matrixWorld,n=(new THREE.Vector3).setFromMatrixPosition(t);x.setPosition(n.x,n.y,n.z);const o=t.clone();o.setPosition({x:0,y:0,z:0});const r=new THREE.Vector3(0,0,1);r.applyMatrix4(o),r.normalize();const a=new THREE.Vector3(0,-1,0);a.applyMatrix4(o),a.normalize(),x.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z)}})}),window.addEventListener("popstate",()=>{h.forEach(e=>{if(q[e]){m(e);for(let t=0,n=j[e].length;t<n;t++)L[e][t].stop(0);document.getElementById(`${e}-sphere-switch`).setAttribute("material","color","cyan"),q[e]=!1}})},!1),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener(r.START,F,!1),function(e){h.forEach(t=>{const n=new XMLHttpRequest;n.open("GET",w[t],!0),n.responseType="arraybuffer",n.send(null),n.onload=()=>{g.decodeAudioData(n.response,n=>{$[t]=n,u(t),document.getElementById(`${t}-sphere-switch`).setAttribute("material","color","cyan");const o=document.getElementById(`${t}-ascn`),r=document.createDocumentFragment();for(let e=0,n=j[t].length;e<n;e++){const n=document.createElement("a-entity");n.setAttribute("id",`${t}-sphere${e}`),n.setAttribute("class","clickable"),n.setAttribute(`${t}-cursor-listener${e}`,""),r.appendChild(n)}o.appendChild(r),B[t]=!1,e()},()=>{})}})}(()=>{document.getElementById("loading-page").classList.add("-hidden"),document.getElementById("front-page").classList.remove("-hidden")}),document.body.requestFullscreen=document.body.requestFullscreen||document.body.webkitRequestFullscreen,document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen;const e=document.getElementById("front-page"),t=document.getElementById("concert"),n=document.getElementById("jazz");document.querySelector('a[href="#concert"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),n.classList.add("-hidden"),t.classList.remove("-hidden"),history.pushState(null,null,`${location.pathname}#/concert`),setTimeout(()=>{const e=document.body.requestFullscreen();void 0===e?document.exitFullscreen():e.then(()=>{document.exitFullscreen()}).catch(()=>{})},250)},!1),document.querySelector('a[href="#jazz"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),t.classList.add("-hidden"),n.classList.remove("-hidden"),history.pushState(null,null,`${location.pathname}#/jazz`),setTimeout(()=>{const e=document.body.requestFullscreen();void 0===e?document.exitFullscreen():e.then(()=>{document.exitFullscreen()}).catch(()=>{})},250)},!1),window.addEventListener("popstate",()=>{t.classList.add("-hidden"),n.classList.add("-hidden"),e.classList.remove("-hidden")},!1)},!0)}});
//# sourceMappingURL=app.js.map