!function(e){function t(t){for(var o,s,a=t[0],c=t[1],d=t[2],u=0,p=[];u<a.length;u++)s=a[u],r[s]&&p.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(t);p.length;)p.shift()();return i.push.apply(i,d||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={0:0},i=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/assets/";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var d=0;d<a.length;d++)t(a[d]);var l=c;i.push([6,1]),n()}({6:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t);class r{}o(r,"CLICK","click"),o(r,"START",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchstart":"mousedown"),o(r,"MOVE",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchmove":"mousemove"),o(r,"END",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchend":"mouseup");var i=n(0),s=n.n(i),a=n(2),c=n.n(a);const d={concert:"https://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/360square-keio-orche2/video.m3u8",pops:"https://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/billboard1_er/video.m3u8"},l={concert:null,pops:null};document.addEventListener("DOMContentLoaded",()=>{l.concert=document.getElementById("concert-video"),l.pops=document.getElementById("pops-video")},!0);const u=e=>{if(c.a.isSupported()){const t=new c.a;t.loadSource(d[e]),t.attachMedia(l[e])}else l[e].canPlayType("application/vnd.apple.mpegurl")&&(l[e].src=d[e],l[e].load())},p=async e=>{try{await l[e].play(),l[e].pause()}catch(e){}},m=(e,t)=>{l[t].currentTime=e},h=["concert","pops"],f=e=>{let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t),o=e[t-1];e[t-1]=e[n],e[n]=o,t--}},y=e=>e<.1?.1:3*e,g=e=>{const t=[0,0,0];return e=2*e-1,t[0]=e<0?0:e>=0&&e<.5?Math.floor(2*e*255):255,t[1]=e<-.5?Math.floor(2*(e+1)*255):e>=-.5&&e<.5?255:255-Math.floor(2*(e-.5)*255),t[2]=e<-.5?255:e>=-.5&&e<0?255-Math.floor(2*(e+.5)*255):0,`rgb(${t[0]}, ${t[1]}, ${t[2]})`},v=new(window.AudioContext||window.webkitAudioContext),b=v.createGain(),w=v.createDynamicsCompressor(),x=v.listener,E={concert:"https://sdm.hongo.wide.ad.jp/~kawa/audio/keio-concert-audiosprited/koc.mp3",pops:"./assets/audio/original.mp3"},A={concert:82.088821,pops:194.61224489},L={concert:[{start:0,end:A.concert},{start:88,end:88+A.concert},{start:176,end:176+A.concert},{start:264,end:264+A.concert},{start:352,end:352+A.concert},{start:440,end:440+A.concert},{start:528,end:528+A.concert},{start:616,end:616+A.concert},{start:704,end:704+A.concert}],pops:[{start:784,end:784+A.pops},{start:0,end:A.pops},{start:196,end:196+A.pops}]},M={concert:[{x:3.05,y:1,z:-7.33},{x:1.86,y:1,z:-3.24},{x:-1.58,y:1,z:3.18},{x:-6.36,y:1,z:-6.79},{x:6.08,y:1,z:-2.51},{x:5.14,y:1,z:1.03},{x:-5.17,y:1,z:1.89},{x:-5.77,y:1,z:-1.29},{x:-9.19,y:1,z:-.91}],pops:[{x:3,y:.5,z:-5},{x:-3,y:1,z:-5},{x:-.5,y:.7,z:-5}]},P={concert:[],pops:[]},T={concert:[],pops:[]},z={concert:[],pops:[]},C={concert:[],pops:[]},S={concert:[],pops:[]};for(let e=0,t=L.concert.length;e<t;e++)S.concert[e]=!1;for(let e=0,t=L.pops.length;e<t;e++)S.pops[e]=!1;const B={concert:{start:0,end:0},pops:{start:0,end:0}},$={concert:0,pops:0},j={concert:0,pops:0},k={concert:null,pops:null},I={concert:!1,pops:!1},O={concert:!0,posp:!0};async function q(){"running"!==v.state&&await v.resume(),document.removeEventListener(r.START,q,!1)}h.forEach(e=>{s.a.registerComponent(`${e}-cursor-listener-switch`,{init:function(){this.el.addEventListener("mousedown",function(){if(!O[e])if(I[e]){p(e);for(let t=0,n=L[e].length;t<n;t++)P[e][t].stop(0);this.setAttribute("material","color","cyan"),I[e]=!1,B[e].start=v.currentTime}else{(async e=>{try{await l[e].play()}catch(e){}})(e);for(let t=0,n=L[e].length;t<n;t++){C[e][t]=v.createAnalyser(),C[e][t].smoothingTimeConstant=.7,T[e][t]=v.createGain(),T[e][t].gain.value=.5,z[e][t]=v.createPanner(),z[e][t].panningModel="equalpower",z[e][t].distanceModel="inverse";const n=document.getElementById(`${e}-sphere${t}`),o=new THREE.Vector3;o.setFromMatrixPosition(n.object3D.matrixWorld);const{x:r,y:i,z:s}=o;z[e][t].setPosition(r,i,s),P[e][t]=v.createBufferSource(),P[e][t].buffer=k[e],P[e][t].connect(T[e][t]),T[e][t].connect(z[e][t]),z[e][t].connect(C[e][t]),C[e][t].connect(b),b.connect(w),w.connect(v.destination),P[e][t].loopStart=L[e][t].start,P[e][t].loopEnd=L[e][t].end,P[e][t].start(0,L[e][t].start+j[e],L[e][t].end-L[e][t].start-j[e]),P[e][t].loop=!0}m(j[e],e),this.setAttribute("material","color","gray"),I[e]=!0}})},tick:function(){O[e]||(I[e]?(B[e].end>0&&($[e]+=B[e].end-B[e].start,B[e].start=0,B[e].end=0),j[e]=v.currentTime-$[e],j[e]>A[e]&&(j[e]-=A[e],$[e]+=A[e],m(j[e],e)),((e,t)=>{const n=l[t].currentTime;l[t].playbackRate=e-n>.1?2:n-e>.1?.5:1})(j[e],e)):B[e].end=v.currentTime)}});for(let t=0,n=L[e].length;t<n;t++){const n=(1+Math.sqrt(5))/2,o=[[1,-n,0],[-1,-n,0],[0,-(2*n+1)/3,n/3],[0,-(2*n+1)/3,-n/3],[0,-1,n],[0,-1,-n],[(n+1)/3,-(n+1)/3,(n+1)/3],[(n+1)/3,-(n+1)/3,-(n+1)/3],[-(n+1)/3,-(n+1)/3,-(n+1)/3],[-(n+1)/3,-(n+1)/3,(n+1)/3],[(2*n+1)/3,-n/3,0],[-(2*n+1)/3,-n/3,0],[n/3,0,(2*n+1)/3],[n,0,1],[n,0,-1],[n/3,0,-(2*n+1)/3],[-n/3,0,-(2*n+1)/3],[-n,0,-1],[-n,0,1],[-n/3,0,(2*n+1)/3],[(2*n+1)/3,n/3,0],[-(2*n+1)/3,n/3,0],[(n+1)/3,(n+1)/3,(n+1)/3],[(n+1)/3,(n+1)/3,-(n+1)/3],[-(n+1)/3,(n+1)/3,-(n+1)/3],[-(n+1)/3,(n+1)/3,(n+1)/3],[0,1,n],[0,1,-n],[0,(2*n+1)/3,n/3],[0,(2*n+1)/3,-n/3],[1,n,0],[-1,n,0]],r=[],i=o.length,a=.15,c=new THREE.Vector3(0,1,0),d={min:null,max:null};f(o),s.a.registerComponent(`${e}-cursor-listener${t}`,{init:function(){this.el.setAttribute("geometry",{primitive:"sphere",radius:1}),this.el.setAttribute("position",M[e][t]),this.el.setAttribute("scale",{x:.3,y:.3,z:.3}),this.el.setAttribute("material",{color:"gray",transparent:!0,opacity:0});for(let e=0;e<i;e++){r[e]=document.createElement("a-entity"),o[e]=new THREE.Vector3(...o[e]).normalize();const t=.1,n=o[e],i=r[e];i.setAttribute("geometry",{primitive:"box",width:a,height:t,depth:a}),i.setAttribute("position",n.clone().multiplyScalar(t/2+1)),i.setAttribute("material",{color:"gray",transparent:!0,opacity:.9}),i.object3D.quaternion.setFromUnitVectors(c,n),this.el.append(i)}this.el.addEventListener("mousedown",function(){I[e]&&(S[e][t]?(T[e][t].gain.value=.5,S[e][t]=!1):(T[e][t].gain.value=0,S[e][t]=!0))})},tick:function(){if(!C[e][t])return;const n=new Uint8Array(C[e][t].frequencyBinCount);C[e][t].getByteFrequencyData(n),null===d.min&&(d.min=C[e][t].frequencyBinCount-1);for(let e=0;e<d.min;e++)if(0!==n[e]){d.min=e;break}null===d.max&&(d.max=0);for(let o=C[e][t].frequencyBinCount-1;o>d.max;o--)if(0!==n[o]){d.max=o;break}const s=d.max-d.min<0?{min:0,max:C[e][t].frequencyBinCount-1}:{min:d.min,max:d.max},a=s.max-s.min+1,c=Math.floor(a/i),l=a%i;for(let a=0,d=s.min;a<i;a++){const i=a<l?c+1:c;let s=0;for(let e=0;e<c;e++)s+=n[d+e];const u=1-2**(-20*((0===i?0:s/i)/255)),p=I[e]&&0!==T[e][t].gain.value?y(u):.1,m=I[e]&&0!==T[e][t].gain.value?g(u):"gray",h=o[a],f=r[a];f.setAttribute("geometry","height",p),f.setAttribute("position",h.clone().multiplyScalar(p/2+1)),f.setAttribute("material","color",m),d+=c}}})}s.a.registerComponent(`${e}-rotation-reader`,{tick:function(){const e=this.el.object3D;e.updateMatrixWorld();const t=e.matrixWorld,n=(new THREE.Vector3).setFromMatrixPosition(t);x.setPosition(n.x,n.y,n.z);const o=t.clone();o.setPosition({x:0,y:0,z:0});const r=new THREE.Vector3(0,0,1);r.applyMatrix4(o),r.normalize();const i=new THREE.Vector3(0,-1,0);i.applyMatrix4(o),i.normalize(),x.setOrientation(r.x,r.y,r.z,i.x,i.y,i.z)}})}),window.addEventListener("popstate",()=>{h.forEach(e=>{if(I[e]){p(e);for(let t=0,n=L[e].length;t<n;t++)P[e][t].stop(0);document.getElementById(`${e}-sphere-switch`).setAttribute("material","color","cyan"),I[e]=!1}})},!1),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener(r.START,q,!1),function(e){h.forEach(t=>{const n=new XMLHttpRequest;n.open("GET",E[t],!0),n.responseType="arraybuffer",n.send(null),n.onload=()=>{v.decodeAudioData(n.response,n=>{k[t]=n,u(t),document.getElementById(`${t}-sphere-switch`).setAttribute("material","color","cyan");const o=document.getElementById(`${t}-ascn`),r=document.createDocumentFragment();for(let e=0,n=L[t].length;e<n;e++){const n=document.createElement("a-entity");n.setAttribute("id",`${t}-sphere${e}`),n.setAttribute("class","clickable"),n.setAttribute(`${t}-cursor-listener${e}`,""),r.appendChild(n)}o.appendChild(r),O[t]=!1,e()},()=>{})}})}(()=>{document.getElementById("loading-page").classList.add("-hidden"),document.getElementById("front-page").classList.remove("-hidden")});const e=document.getElementById("front-page"),t=document.getElementById("concert"),n=document.getElementById("pops");document.querySelector('a[href="#concert"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),n.classList.add("-hidden"),t.classList.remove("-hidden"),history.pushState(null,null,"/#/concert")},!1),document.querySelector('a[href="#pops"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),t.classList.add("-hidden"),n.classList.remove("-hidden"),history.pushState(null,null,"/#/pops")},!1),window.addEventListener("popstate",()=>{t.classList.add("-hidden"),n.classList.add("-hidden"),e.classList.remove("-hidden")},!1)},!0)}});
//# sourceMappingURL=app.js.map