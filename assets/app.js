!function(e){function t(t){for(var o,i,c=t[0],s=t[1],d=t[2],u=0,m=[];u<c.length;u++)i=c[u],r[i]&&m.push(r[i][0]),r[i]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);for(l&&l(t);m.length;)m.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,c=1;c<n.length;c++){var s=n[c];0!==r[s]&&(o=!1)}o&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var o={},r={0:0},a=[];function i(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/assets/";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var d=0;d<c.length;d++)t(c[d]);var l=s;a.push([6,1]),n()}({6:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t);class r{}o(r,"CLICK","click"),o(r,"START",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchstart":"mousedown"),o(r,"MOVE",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchmove":"mousemove"),o(r,"END",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchend":"mouseup");var a=n(0),i=n.n(a),c=n(2),s=n.n(c);const d={concert:"https://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/360square-keio-orche2/video.m3u8",jazz:"https://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/billboard1_er/video.m3u8"},l={concert:null,jazz:null};document.addEventListener("DOMContentLoaded",()=>{l.concert=document.getElementById("concert-video"),l.jazz=document.getElementById("jazz-video")},!0);const u=e=>{if(s.a.isSupported()){const t=new s.a;t.loadSource(d[e]),t.attachMedia(l[e])}else l[e].canPlayType("application/vnd.apple.mpegurl")&&(l[e].src=d[e],l[e].load())},m=async e=>{try{await l[e].play(),l[e].pause()}catch(e){}},p=(e,t)=>{l[t].currentTime=e},h=["concert","jazz"],f=e=>{let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t),o=e[t-1];e[t-1]=e[n],e[n]=o,t--}},y=e=>e<.1?.1:3*e,z=e=>{const t=[0,0,0];return e=2*e-1,t[0]=e<0?0:e>=0&&e<.5?Math.floor(2*e*255):255,t[1]=e<-.5?Math.floor(2*(e+1)*255):e>=-.5&&e<.5?255:255-Math.floor(2*(e-.5)*255),t[2]=e<-.5?255:e>=-.5&&e<0?255-Math.floor(2*(e+.5)*255):0,`rgb(${t[0]}, ${t[1]}, ${t[2]})`},g=new(window.AudioContext||window.webkitAudioContext),v=g.createGain(),b=g.createDynamicsCompressor(),j=g.listener,w={concert:"https://sdm.hongo.wide.ad.jp/~kawa/audio/keio-concert-audiosprited/koc.mp3",jazz:"./assets/audio/original.mp3"},x={concert:82.088821,jazz:194.61224489},E={concert:[{start:0,end:x.concert},{start:88,end:88+x.concert},{start:176,end:176+x.concert},{start:264,end:264+x.concert},{start:352,end:352+x.concert},{start:440,end:440+x.concert},{start:528,end:528+x.concert},{start:616,end:616+x.concert},{start:704,end:704+x.concert}],jazz:[{start:784,end:784+x.jazz},{start:0,end:x.jazz},{start:196,end:196+x.jazz}]},A={concert:[{x:3.05,y:1,z:-7.33},{x:1.86,y:1,z:-3.24},{x:-1.58,y:1,z:3.18},{x:-6.36,y:1,z:-6.79},{x:6.08,y:1,z:-2.51},{x:5.14,y:1,z:1.03},{x:-5.17,y:1,z:1.89},{x:-5.77,y:1,z:-1.29},{x:-9.19,y:1,z:-.91}],jazz:[{x:3,y:.5,z:-5},{x:-3,y:1,z:-5},{x:-.5,y:.7,z:-5}]},L={concert:[],jazz:[]},M={concert:[],jazz:[]},P={concert:[],jazz:[]},T={concert:[],jazz:[]},C={concert:[],jazz:[]};for(let e=0,t=E.concert.length;e<t;e++)C.concert[e]=!1;for(let e=0,t=E.jazz.length;e<t;e++)C.jazz[e]=!1;const S={concert:{start:0,end:0},jazz:{start:0,end:0}},$={concert:0,jazz:0},B={concert:0,jazz:0},k={concert:null,jazz:null},O={concert:!1,jazz:!1},I={concert:!0,jazz:!0};async function q(){"running"!==g.state&&await g.resume(),document.removeEventListener(r.START,q,!1)}h.forEach(e=>{i.a.registerComponent(`${e}-cursor-listener-switch`,{init:function(){this.el.addEventListener("mousedown",function(){if(!I[e])if(O[e]){m(e);for(let t=0,n=E[e].length;t<n;t++)L[e][t].stop(0);this.setAttribute("material","color","cyan"),O[e]=!1,S[e].start=g.currentTime}else{(async e=>{try{await l[e].play()}catch(e){}})(e);for(let t=0,n=E[e].length;t<n;t++){T[e][t]=g.createAnalyser(),T[e][t].smoothingTimeConstant=.7,M[e][t]=g.createGain(),M[e][t].gain.value=.5,P[e][t]=g.createPanner(),P[e][t].panningModel="equalpower",P[e][t].distanceModel="inverse";const n=document.getElementById(`${e}-sphere${t}`),o=new THREE.Vector3;o.setFromMatrixPosition(n.object3D.matrixWorld);const{x:r,y:a,z:i}=o;P[e][t].setPosition(r,a,i),L[e][t]=g.createBufferSource(),L[e][t].buffer=k[e],L[e][t].connect(M[e][t]),M[e][t].connect(P[e][t]),P[e][t].connect(T[e][t]),T[e][t].connect(v),v.connect(b),b.connect(g.destination),L[e][t].loopStart=E[e][t].start,L[e][t].loopEnd=E[e][t].end,L[e][t].start(0,E[e][t].start+B[e],E[e][t].end-E[e][t].start-B[e]),L[e][t].loop=!0}p(B[e],e),this.setAttribute("material","color","gray"),O[e]=!0}})},tick:function(){I[e]||(O[e]?(S[e].end>0&&($[e]+=S[e].end-S[e].start,S[e].start=0,S[e].end=0),B[e]=g.currentTime-$[e],B[e]>x[e]&&(B[e]-=x[e],$[e]+=x[e],p(B[e],e)),((e,t)=>{const n=l[t].currentTime;l[t].playbackRate=e-n>.1?2:n-e>.1?.5:1})(B[e],e)):S[e].end=g.currentTime)}});for(let t=0,n=E[e].length;t<n;t++){const n=(1+Math.sqrt(5))/2,o=[[1,-n,0],[-1,-n,0],[0,-(2*n+1)/3,n/3],[0,-(2*n+1)/3,-n/3],[0,-1,n],[0,-1,-n],[(n+1)/3,-(n+1)/3,(n+1)/3],[(n+1)/3,-(n+1)/3,-(n+1)/3],[-(n+1)/3,-(n+1)/3,-(n+1)/3],[-(n+1)/3,-(n+1)/3,(n+1)/3],[(2*n+1)/3,-n/3,0],[-(2*n+1)/3,-n/3,0],[n/3,0,(2*n+1)/3],[n,0,1],[n,0,-1],[n/3,0,-(2*n+1)/3],[-n/3,0,-(2*n+1)/3],[-n,0,-1],[-n,0,1],[-n/3,0,(2*n+1)/3],[(2*n+1)/3,n/3,0],[-(2*n+1)/3,n/3,0],[(n+1)/3,(n+1)/3,(n+1)/3],[(n+1)/3,(n+1)/3,-(n+1)/3],[-(n+1)/3,(n+1)/3,-(n+1)/3],[-(n+1)/3,(n+1)/3,(n+1)/3],[0,1,n],[0,1,-n],[0,(2*n+1)/3,n/3],[0,(2*n+1)/3,-n/3],[1,n,0],[-1,n,0]],r=[],a=o.length,c=.15,s=new THREE.Vector3(0,1,0),d={min:null,max:null};f(o),i.a.registerComponent(`${e}-cursor-listener${t}`,{init:function(){this.el.setAttribute("geometry",{primitive:"sphere",radius:1}),this.el.setAttribute("position",A[e][t]),this.el.setAttribute("scale",{x:.3,y:.3,z:.3}),this.el.setAttribute("material",{color:"gray",transparent:!0,opacity:0});for(let e=0;e<a;e++){r[e]=document.createElement("a-entity"),o[e]=new THREE.Vector3(...o[e]).normalize();const t=.1,n=o[e],a=r[e];a.setAttribute("geometry",{primitive:"box",width:c,height:t,depth:c}),a.setAttribute("position",n.clone().multiplyScalar(t/2+1)),a.setAttribute("material",{color:"gray",transparent:!0,opacity:.9}),a.object3D.quaternion.setFromUnitVectors(s,n),this.el.append(a)}this.el.addEventListener("mousedown",function(){O[e]&&(C[e][t]?(M[e][t].gain.value=.5,C[e][t]=!1):(M[e][t].gain.value=0,C[e][t]=!0))})},tick:function(){if(!T[e][t])return;const n=new Uint8Array(T[e][t].frequencyBinCount);T[e][t].getByteFrequencyData(n),null===d.min&&(d.min=T[e][t].frequencyBinCount-1);for(let e=0;e<d.min;e++)if(0!==n[e]){d.min=e;break}null===d.max&&(d.max=0);for(let o=T[e][t].frequencyBinCount-1;o>d.max;o--)if(0!==n[o]){d.max=o;break}const i=d.max-d.min<0?{min:0,max:T[e][t].frequencyBinCount-1}:{min:d.min,max:d.max},c=i.max-i.min+1,s=Math.floor(c/a),l=c%a;for(let c=0,d=i.min;c<a;c++){const a=c<l?s+1:s;let i=0;for(let e=0;e<s;e++)i+=n[d+e];const u=1-2**(-20*((0===a?0:i/a)/255)),m=O[e]&&0!==M[e][t].gain.value?y(u):.1,p=O[e]&&0!==M[e][t].gain.value?z(u):"gray",h=o[c],f=r[c];f.setAttribute("geometry","height",m),f.setAttribute("position",h.clone().multiplyScalar(m/2+1)),f.setAttribute("material","color",p),d+=s}}})}i.a.registerComponent(`${e}-rotation-reader`,{tick:function(){const e=this.el.object3D;e.updateMatrixWorld();const t=e.matrixWorld,n=(new THREE.Vector3).setFromMatrixPosition(t);j.setPosition(n.x,n.y,n.z);const o=t.clone();o.setPosition({x:0,y:0,z:0});const r=new THREE.Vector3(0,0,1);r.applyMatrix4(o),r.normalize();const a=new THREE.Vector3(0,-1,0);a.applyMatrix4(o),a.normalize(),j.setOrientation(r.x,r.y,r.z,a.x,a.y,a.z)}})}),window.addEventListener("popstate",()=>{h.forEach(e=>{if(O[e]){m(e);for(let t=0,n=E[e].length;t<n;t++)L[e][t].stop(0);document.getElementById(`${e}-sphere-switch`).setAttribute("material","color","cyan"),O[e]=!1}})},!1),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener(r.START,q,!1),function(e){h.forEach(t=>{const n=new XMLHttpRequest;n.open("GET",w[t],!0),n.responseType="arraybuffer",n.send(null),n.onload=()=>{g.decodeAudioData(n.response,n=>{k[t]=n,u(t),document.getElementById(`${t}-sphere-switch`).setAttribute("material","color","cyan");const o=document.getElementById(`${t}-ascn`),r=document.createDocumentFragment();for(let e=0,n=E[t].length;e<n;e++){const n=document.createElement("a-entity");n.setAttribute("id",`${t}-sphere${e}`),n.setAttribute("class","clickable"),n.setAttribute(`${t}-cursor-listener${e}`,""),r.appendChild(n)}o.appendChild(r),I[t]=!1,e()},()=>{})}})}(()=>{t.classList.add("-hidden"),n.classList.add("-hidden"),e.classList.remove("-hidden"),document.getElementById("loading-page").classList.add("-hidden")});const e=document.getElementById("front-page"),t=document.getElementById("concert"),n=document.getElementById("jazz");document.querySelector('a[href="#concert"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),n.classList.add("-hidden"),t.classList.remove("-hidden"),history.pushState(null,null,`${location.pathname}#/concert`)},!1),document.querySelector('a[href="#jazz"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),t.classList.add("-hidden"),n.classList.remove("-hidden"),history.pushState(null,null,`${location.pathname}#/jazz`)},!1),window.addEventListener("popstate",()=>{t.classList.add("-hidden"),n.classList.add("-hidden"),e.classList.remove("-hidden")},!1)},!0)}});
//# sourceMappingURL=app.js.map