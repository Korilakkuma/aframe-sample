!function(e){function t(t){for(var o,a,s=t[0],c=t[1],l=t[2],u=0,m=[];u<s.length;u++)a=s[u],r[a]&&m.push(r[a][0]),r[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(d&&d(t);m.length;)m.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={0:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/assets/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;i.push([6,1]),n()}({6:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t);class r{}o(r,"CLICK","click"),o(r,"START",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchstart":"mousedown"),o(r,"MOVE",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchmove":"mousemove"),o(r,"END",/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?"touchend":"mouseup");var i=n(0),a=n.n(i),s=n(1),c=n.n(s);const l="http://sdm.hongo.wide.ad.jp/~shin/assets/video/hls/360square-keio-orche2/video.m3u8";let d=null,u=null;document.addEventListener("DOMContentLoaded",()=>{d=document.getElementById("video")},!0);const m=()=>{if(c.a.isSupported()){const e=new c.a;e.loadSource(l),e.attachMedia(d),e.on(c.a.Events.MANIFEST_PARSED,()=>{console.log("video is ready")})}else d.canPlayType("application/vnd.apple.mpegurl")&&(d.src=l,d.addEventListener("loadedmetadata",()=>{console.log("video is ready")}))},p=()=>{const e=d.play();void 0!==e&&e.then(()=>{clearTimeout(u),u=null}).catch(()=>{u=setTimeout(p,1e3)})},h=e=>{d.currentTime=e},f=new(window.AudioContext||window.webkitAudioContext),y=f.createGain(),g=f.createDynamicsCompressor(),v=f.listener,b="http://sdm.hongo.wide.ad.jp/~kawa/audio/keio-concert-audiosprited/koc.mp3",x=86.6250113378685,E=[{start:0,end:x},{start:88,end:88+x},{start:176,end:176+x},{start:264,end:264+x},{start:352,end:352+x},{start:440,end:440+x},{start:528,end:528+x},{start:616,end:616+x},{start:704,end:704+x}],w=[{x:3.05,y:1,z:-7.33},{x:1.86,y:1,z:-3.24},{x:-1.58,y:1,z:3.18},{x:-6.36,y:1,z:-6.79},{x:6.08,y:1,z:-2.51},{x:5.14,y:1,z:1.03},{x:-5.17,y:1,z:1.89},{x:-5.77,y:1,z:-1.29},{x:-9.19,y:1,z:-1.41}],A=[],L=[],M=[],P=[],T=[],C=[];for(let e=0,t=E.length;e<t;e++)T[e]=!1,C[e]=0;let S=null,z=!1,j=!0;a.a.registerComponent("cursor-listener-switch",{init:function(){this.el.addEventListener("mousedown",function(){if(!j)if(z){d.play().then(()=>{d.pause()}).catch(()=>{});for(let e=0,t=E.length;e<t;e++)A[e].stop(0);this.setAttribute("material","color","cyan"),z=!1}else{p();for(let e=0,t=E.length;e<t;e++){P[e]=f.createAnalyser(),P[e].smoothingTimeConstant=.7,L[e]=f.createGain(),L[e].gain.value=.5,M[e]=f.createPanner(),M[e].panningModel="equalpower",M[e].distanceModel="inverse";const t=document.getElementById(`sphere${e}`),n=new THREE.Vector3;n.setFromMatrixPosition(t.object3D.matrixWorld);const{x:o,y:r,z:i}=n;M[e].setPosition(o,r,i),A[e]=f.createBufferSource(),A[e].buffer=S,A[e].connect(L[e]),L[e].connect(M[e]),M[e].connect(P[e]),P[e].connect(y),y.connect(g),g.connect(f.destination),A[e].loopStart=E[e].start,A[e].loopEnd=E[e].end;let a=C[e]>0?f.currentTime-C[e]:0;a>x&&(a=0,C[e]=0),A[e].start(0,E[e].start+a,E[e].end-E[e].start-a),A[e].loop=!0,h(a),C[e]=f.currentTime}this.setAttribute("material","color","gray"),z=!0}})}});const O=e=>{let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t),o=e[t-1];e[t-1]=e[n],e[n]=o,t--}};for(let e=0,t=E.length;e<t;e++){const t=(1+Math.sqrt(5))/2,n=[[1,-t,0],[-1,-t,0],[0,-(2*t+1)/3,t/3],[0,-(2*t+1)/3,-t/3],[0,-1,t],[0,-1,-t],[(t+1)/3,-(t+1)/3,(t+1)/3],[(t+1)/3,-(t+1)/3,-(t+1)/3],[-(t+1)/3,-(t+1)/3,-(t+1)/3],[-(t+1)/3,-(t+1)/3,(t+1)/3],[(2*t+1)/3,-t/3,0],[-(2*t+1)/3,-t/3,0],[t/3,0,(2*t+1)/3],[t,0,1],[t,0,-1],[t/3,0,-(2*t+1)/3],[-t/3,0,-(2*t+1)/3],[-t,0,-1],[-t,0,1],[-t/3,0,(2*t+1)/3],[(2*t+1)/3,t/3,0],[-(2*t+1)/3,t/3,0],[(t+1)/3,(t+1)/3,(t+1)/3],[(t+1)/3,(t+1)/3,-(t+1)/3],[-(t+1)/3,(t+1)/3,-(t+1)/3],[-(t+1)/3,(t+1)/3,(t+1)/3],[0,1,t],[0,1,-t],[0,(2*t+1)/3,t/3],[0,(2*t+1)/3,-t/3],[1,t,0],[-1,t,0]],o=[],r=n.length,i=.15,s=new THREE.Vector3(0,1,0),c={min:null,max:null};O(n),a.a.registerComponent(`cursor-listener${e}`,{init:function(){this.el.setAttribute("geometry",{primitive:"sphere",radius:.6}),this.el.setAttribute("position",w[e]),this.el.setAttribute("scale",{x:.3,y:.3,z:.3}),this.el.setAttribute("material",{color:"gray",transparent:!0,opacity:0});for(let e=0;e<r;e++){o[e]=document.createElement("a-entity"),n[e]=new THREE.Vector3(...n[e]).normalize();const t=.1,r=n[e],a=o[e];a.setAttribute("geometry",{primitive:"box",width:i,height:t,depth:i}),a.setAttribute("position",r.clone().multiplyScalar(t/2+1)),a.setAttribute("material",{color:"gray",transparent:!0,opacity:.9}),a.object3D.quaternion.setFromUnitVectors(s,r),this.el.append(a)}this.el.addEventListener("mousedown",function(){z&&(T[e]?(L[e].gain.value=.5,T[e]=!1):(L[e].gain.value=0,T[e]=!0))})},tick:function(){if(!P[e])return;const t=new Uint8Array(P[e].frequencyBinCount);P[e].getByteFrequencyData(t),null===c.min&&(c.min=P[e].frequencyBinCount-1);for(let e=0;e<c.min;e++)if(0!==t[e]){c.min=e;break}null===c.max&&(c.max=0);for(let n=P[e].frequencyBinCount-1;n>c.max;n--)if(0!==t[n]){c.max=n;break}const i=c.max-c.min<0?{min:0,max:P[e].frequencyBinCount-1}:{min:c.min,max:c.max},a=i.max-i.min+1,s=Math.floor(a/r),l=a%r;for(let a=0,c=i.min;a<r;a++){const r=a<l?s+1:s;let i=0;for(let e=0;e<s;e++)i+=t[c+e];const d=1-2**(-20*((0===r?0:i/r)/255)),u=0===L[e].gain.value?.1:k(d),m=0===L[e].gain.value?"gray":B(d),p=n[a],h=o[a];h.setAttribute("geometry","height",u),h.setAttribute("position",p.clone().multiplyScalar(u/2+1)),h.setAttribute("material","color",m),c+=s}}})}const k=e=>e<.1?.1:3*e,B=e=>{const t=[0,0,0];return e=2*e-1,t[0]=e<0?0:e>=0&&e<.5?Math.floor(2*e*255):255,t[1]=e<-.5?Math.floor(2*(e+1)*255):e>=-.5&&e<.5?255:255-Math.floor(2*(e-.5)*255),t[2]=e<-.5?255:e>=-.5&&e<0?255-Math.floor(2*(e+.5)*255):0,`rgb(${t[0]}, ${t[1]}, ${t[2]})`};async function D(){"running"!==f.state&&await f.resume(),document.removeEventListener(r.START,D,!1)}a.a.registerComponent("rotation-reader",{tick:function(){const e=this.el.object3D;e.updateMatrixWorld();const t=e.matrixWorld,n=(new THREE.Vector3).setFromMatrixPosition(t);v.setPosition(n.x,n.y,n.z);const o=t.clone();o.setPosition({x:0,y:0,z:0});const r=new THREE.Vector3(0,0,1);r.applyMatrix4(o),r.normalize();const i=new THREE.Vector3(0,-1,0);i.applyMatrix4(o),i.normalize(),v.setOrientation(r.x,r.y,r.z,i.x,i.y,i.z)}}),document.addEventListener("DOMContentLoaded",()=>{document.addEventListener(r.START,D,!1),function(){const e=new XMLHttpRequest;e.open("GET",b,!0),e.responseType="arraybuffer",e.send(null),e.onload=(()=>{f.decodeAudioData(e.response,e=>{S=e,m(),document.getElementById("sphere-switch").setAttribute("material","color","cyan");const t=document.getElementById("ascn"),n=document.createDocumentFragment();for(let e=0,t=E.length;e<t;e++){const t=document.createElement("a-entity");t.setAttribute("id",`sphere${e}`),t.setAttribute("class","clickable"),t.setAttribute(`cursor-listener${e}`,""),n.appendChild(t)}t.appendChild(n),j=!1},()=>{})})}();const e=document.getElementById("front-page"),t=document.getElementById("concert"),n=document.getElementById("pops");document.querySelector('a[href="#concert"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),n.classList.add("-hidden"),t.classList.remove("-hidden"),history.pushState(null,null,"/#/concert")},!1),document.querySelector('a[href="#pops"]').addEventListener(r.CLICK,o=>{o.preventDefault(),e.classList.add("-hidden"),t.classList.add("-hidden"),n.classList.remove("-hidden"),history.pushState(null,null,"/#/pops")},!1),window.addEventListener("popstate",()=>{t.classList.add("-hidden"),n.classList.add("-hidden"),e.classList.remove("-hidden")})},!0)}});
//# sourceMappingURL=app.js.map